https://stickersvk.com/ru/starwarsforce/

 foreach (var s in dg.Items)
                    {
                        var obj = s as Service_Dagorlad.Chat;
                        if(obj.images!=null && obj.images.Length>0)
                        {

                        }
                    }

                    //foreach(var s in dg.ItemsSource.Cast<Service_Dagorlad.Chat>().ToList())
                    //{
                    //    if(s.text.Contains("base64:"))
                    //    {
                    //        var splitted = s.text.Split(new char[] { '[', ']' });
                    //        var sel = splitted.Select(x => x.Contains("base64")).FirstOrDefault().ToString();
                    //        var replaced = sel.Replace("base64:", String.Empty);
                    //        var bytes = Convert.FromBase64String(replaced);
                    //        var image = LoadImage(bytes);

                        //    }
                        //}

private static BitmapImage LoadImage(byte[] imageData)
        {
            if (imageData == null || imageData.Length == 0) return null;
            var image = new BitmapImage();
            using (var mem = new MemoryStream(imageData))
            {
                mem.Position = 0;
                image.BeginInit();
                image.CreateOptions = BitmapCreateOptions.PreservePixelFormat;
                image.CacheOption = BitmapCacheOption.OnLoad;
                image.UriSource = null;
                image.StreamSource = mem;
                image.EndInit();
            }
            image.Freeze();
            return image;
        }

 public static string RtbToBase64(System.Windows.Controls.RichTextBox rtb)
        {
            if (rtb.Document.Blocks != null)
            {
                foreach (var s in rtb.Document.Blocks)
                {
                    if(s.GetType()==typeof(BlockUIContainer))
                    {
                        var child = (BlockUIContainer)s;
                        if (child != null)
                        {
                            var ControlsImage = child.Child as System.Windows.Controls.Image;
                            if (ControlsImage != null)
                            {
                                ImageSource image = ControlsImage.Source;
                                var bytes=ImageSourceToBytes(image);
                                var base64 = Convert.ToBase64String(bytes);
                                return base64;
                            }
                        }
                    }
                }
            }
            return null;
        }

   public static byte[] ImageSourceToBytes(ImageSource imageSource)
        {
            byte[] bytes = null;
            var bitmapSource = imageSource as BitmapSource;

            if (bitmapSource != null)
            {
                var encoder = new JpegBitmapEncoder();
                encoder.Frames.Add(BitmapFrame.Create(bitmapSource));

                using (var stream = new MemoryStream())
                {
                    encoder.Save(stream);
                    bytes = stream.ToArray();
                }
            }

            return bytes;
        }